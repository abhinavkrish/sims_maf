{% extends "master.html" %}

{% set active_page = "listMetrics" %}

{% set run = runlist.getRun(runId) %}

{% block moresidebar %}
<ul>
{% for g in run.groups.keys() %}
  <li>
  <a href="#{{g|escape}}"> {{g|escape}}</a> </br> 
  {% for sg in run.groups[g] %}
    <div id='indent'><a href="#{{g|escape}}_{{sg|escape}}">{{sg|escape}}</a></div> 
 {% endfor %}
 </li>
{% endfor %}
</ul>

{% endblock %}


{% block content %}

<form name="MetricSelect" action="metricResults" method="get" >
<input type="hidden" name="runId" value="{{runId}}">

<table>

{% set metricInfo = run.metricInfo(run.metrics[0], withDataFile=True) %}
{% set mInfoLen = metricInfo|length + 1 %}
  
<tr>
<th> </th>
{% for key in metricInfo %}
  <th> {{ key }} </th>
{% endfor %}
  <th>JSON</th>
</tr>

<tr>
<td> </td>
<td colspan={{mInfoLen}}>
<input type='submit' value='Plot Metrics'>
</td>
</tr>

{% for group in run.groups %}
  {% set groupstart = True %}
  {% for subgroup in run.groups[group] %}
      <tr class="lightestgray">
	<td>
	  <input type='checkbox' name="Group_subgroup"
  value="{{ group|escape }}__{{ subgroup|escape }}">
	</td>
	<td colspan={{mInfoLen}}>
	{% if groupstart == True %}
	  <a name="{{group}}"></a>
	  {% set groupstart = False %}
	{% endif %}
	  <a name="{{group|escape}}_{{subgroup|escape}}">All  Group: <em>{{group|escape
    }}</em>;   Subgroup: <em>{{ subgroup|escape }}</em></a>
	 </td>
        </tr>
       {% set metrics = run.metricsInSubgroup(group, subgroup) %}
       {% for metric in metrics %}
          {% set metricInfo = run.metricInfo(metric,
  withDataFile=True) %}
          <tr>
	  <td>
          <input type='checkbox' name="metricId" value="{{metric['metricId']}}"> 
	  </td>
	  {% for key in metricInfo %}
           <td>
	   {% if key == 'Data' %}
	    {% if metricInfo[key][0] != 'NULL' %}
	    <a href="{{metricInfo[key][1]}}">{{metricInfo[key][0]|escape}}</a>
	    {% else %}
	     N/A
	    {% endif %}
	   {% else %}
            {{ metricInfo[key]|escape }}
           {% endif %}
          </td>
	  {% endfor %} {# End of metric info keys #}
	  <td>
	   <a href="json?runId={{runId}}&metricId={{metric['metricId']}}">JSON</a>
	  </td>
	  </tr>
	{% endfor %} {# End of metrics #}
    {% endfor %}  {# End of subgroup #}
 {% endfor %}  {# End of group #}
<tr>
<td> </td>
<td colspan="3">
<input type='submit' value='Plot Metrics'>
</form> 
</td>
</tr>

</table>

{% endblock %}
